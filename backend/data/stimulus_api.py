"""Serve stimulus stories and DDM grids as API data."""
from fastapi import APIRouter

router = APIRouter(prefix="/api/stimulus", tags=["stimulus"])

NLM_READING_STORIES = {
    "1": {
        "benchmark": {
            "BOY": [
                {"id": "1-BM1-BOY", "title": "First Grade: Benchmark 1 (BOY)", "text": "Kam was on a rug with some little toys. A boy saw her toys and grabbed all of them. The boy did not hand them back, so Kam was sad. Kam sat on the rug and made a plan to get the toys. She was going to get them back. Kam decided to get help from her teacher, who was distracted by other kids. She asked her teacher, \"Can you please help me get my stolen blocks returned to me?\" Her teacher calmly replied, \"When I'm done teaching, I'll speak with your classmate and tell him he needs to share so that you can play together.\" After Kam sat back down, the boy started sharing because the teacher talked to him. Kam and the boy expertly fabricated a mansion that was expansive. Since it was a very big house with lots of rooms, she had to stand on her tiptoes to put the last block on. She was very pleased because they had collaborated together using the blocks which came from two big, deep tubs."},
                {"id": "1-BM2-BOY", "title": "First Grade: Benchmark 2 (BOY)", "text": "Last week, Jen sat on the grass with a rose bush that her mom got at a shop. Jen's mom told her to plant the bush, but it began to make her itch. Then her face started to get red, and she had to rub her nose a lot. Although she had quickly dropped the rose, her eyes started watering too. She was upset because the itching wouldn't cease. She immediately went inside because she was miserable. Jen decided to tell her mom, who was in the kitchen. She frantically said, \"Mom, my eyes and nose really itch, and I need your help.\" Jen's mom helpfully said, \"You have allergies, which I know all about. Allergies can be caused by plants and can make you itch. I have some eye drops to help.\" When they went inside, her mom gently put the calming drops in her irritated eyes. Jen was pleased because her red eyes, that were swollen, stopped itching. After Jen got help, they finished planting the gorgeous rose bush together."},
            ],
            "MOY": [
                {"id": "1-BM1-MOY", "title": "First Grade: Benchmark 1 (MOY)", "text": "One day, Jack was in his room. He was getting ready to go swim in his big pool. When Jack was ready to go, his mom, who was strict, stopped him. She said he could not swim because he had not picked up his toys yet. Jack was upset. It was a beautiful, warm morning. He wanted to practice swimming with his new kickboard. A kickboard is a small, foam board which helps you float. You hold on to it so that you can practice kicking. But he had to tidy up his messy bedroom. He decided to get to work. Since he really wanted to swim, he worked hard. After Jack spent almost three hours cleaning, he urgently found his mom. He said, \"Can I swim now because I completely finished the tasks that you gave me?\" Jack's mom proudly replied, \"You cleaned your room so well. It is stunning!\" His mom was perfectly satisfied. Jack felt happy. He ate lunch, then he eagerly swam in the refreshing pool while his mom closely watched him."},
                {"id": "1-BM2-MOY", "title": "First Grade: Benchmark 2 (MOY)", "text": "One day, Ron was with his dad at a fun park. He wanted to go on all the fun rides. He stopped at a tall ride that was fast and spun a lot. He went on it. But at the end of the ride, he started to feel sick. He was scared because his stomach suddenly felt uneasy. Ron decided to find his dad, who was nearby. He urgently said, \"I went on a ride that rapidly rotated and I might throw up!\" Ron's dad replied, \"Since you feel sick, it sounds like you have motion sickness. Let's find a calm, relaxing place so that you can rest.\" Ron's dad told him about motion sickness. He explained it happens when you stop moving but the fluid in your ears doesn't and it can make you nauseous. His dad quickly found a nearby bench, and had Ron sit down. After several minutes, Ron felt relieved because he didn't feel sick anymore. Then he blissfully rode calmer carnival rides, which didn't spin, for the rest of the day."},
            ],
            "EOY": [
                {"id": "1-BM1-EOY", "title": "First Grade: Benchmark 1 (EOY)", "text": "One day, Owen was out playing in the rain. After he jumped in a big puddle, Owen got water in his new shoes. His shoes were not very tall, so they got wet. Owen was sad because his feet were very wet and cold. He knew he needed to get help. Owen ran to his mom, who was standing outside their apartment. He said, \"Can you help me? These shoes that I thought were waterproof are totally freezing my feet.\" When Owen's mom saw him, she pulled him under her umbrella since he was completely drenched. She kindly said, \"I think we have a raincoat and some old galoshes. Galoshes are really tall boots that are made of waterproof rubber. They should fit you.\" After she quickly found them, Owen's mom took off his soaking wet shoes and dumped out the water so that they wouldn't get ruined. Even though she struggled getting the galoshes on Owen's feet, she eventually succeeded. Owen was relieved because he was able to frolic in the puddles without getting wet."},
                {"id": "1-BM2-EOY", "title": "First Grade: Benchmark 2 (EOY)", "text": "Last week, Ben was at his dad's house. It was late and he was watching TV. His dad told him it was time to brush his teeth and go to bed. Ben was upset because he did not want to go to bed. After Ben brushed his teeth, he made a plan. Ben quickly pulled a book off the shelf. When his dad tucked him in, Ben timidly asked, \"Will you please read this story to me?\" Ben's dad, who studied the cover, said, \"This book, again? OK, but just a few pages since it's so late.\" It was a funny chapter book. Chapter books, which are long stories that are divided into smaller parts, usually don't have colorful drawings. His dad began dramatically reading the book using different voices. Ben's vivid imagination ran wild. He clearly pictured what was happening in the story! Although Ben was happy because he got to stay up late, he was getting tired. When his dad finished reading, he snuggled under the covers so that he could go to sleep."},
            ],
        },
    },
    "2": {
        "benchmark": {
            "BOY": [
                {"id": "2-BM1-BOY", "title": "Second Grade: Benchmark 1 (BOY)", "text": "Yesterday, Marta and her mom were shopping at a store. She needed to get a gift for her friend. She was upset because she didn't have much time. Marta was thinking about getting a game. Her friend had a new computer with lots of RAM, which helps it run fast and open many things all at the same time. She dug through the bin of games and finally found a great game. But sadly, she didn't have the money to buy it. Marta felt bad because she still didn't have a gift. After she put the game back, she decided to ask her artistic mom, who was very creative, for guidance. She urgently said, \"What should I give my best friend?\" Marta's mom said, \"Make her something at home. It will be more meaningful.\" Although Marta didn't have a lot of time, she was able to make the perfect gift. When her friend eagerly opened the present, she loved the beautiful, personalized gift. Marta was extremely happy because she got to give her friend something that she cherished."},
                {"id": "2-BM2-BOY", "title": "Second Grade: Benchmark 2 (BOY)", "text": "Last week, Cora was exploring a theme park. She wanted to go on all the big rides, but she was not able to because she was too short. Even though Cora was upset, she hoped to find other rides that were fun. After she looked for a while, Cora found a thrilling ride that was shaped like a giant snake, and it went really fast. But when she tried to get on it, a man, who wore a uniform, sadly told Cora she was too short. The man explained he had to enforce the strict safety regulations, which were rules that must be obeyed so that people don't get hurt. Cora felt disappointed because it seemed like she would never find a suitable ride. She decided to ask the man for help. Cora optimistically said, \"Can you show me a fun ride I'm tall enough for?\" He said, \"Yes! The Ferris wheel should be perfect!\" When she saw it, Cora quickly got on ride. After the exhilarating ride was finished, Cora was happy because she finally discovered a perfect, fun ride."},
            ],
            "MOY": [
                {"id": "2-BM1-MOY", "title": "Second Grade: Benchmark 1 (MOY)", "text": "One day, Daniel was in his art class making a small clay pot. When he was done, he went to pick up the pot, but it was stuck to the table, which made him nervous. Daniel decided to try to gently lift it off the table so that he wouldn't ruin it. But Daniel's pot was really stuck. Daniel was sad and put his head on the table. Finally, Daniel decided to get help. Daniel said to his teacher \"My pot is stuck!\" Daniel's teacher kindly said, \"Before I work with clay, I put canvas down because canvas is a thick cloth that is made from cotton. The clay won't adhere to it. Since your pot is already stuck, I'll remove it using a special technique.\" Then she quickly illustrated how to get it unstuck. Daniel closely observed the teacher, who had solved this problem many times, take some thin wire and deftly slide it under the pot. When he saw it easily come right off the table, Daniel immediately felt relieved because he wouldn't have to construct a new pot."},
                {"id": "2-BM2-MOY", "title": "Second Grade: Benchmark 2 (MOY)", "text": "On Sunday, Fiona, a very shy girl, was in the car with her family. They slowly pulled into her grandpa's big driveway. She saw lots of cars parked at her grandpa's house. Fiona was upset because she didn't know there would be so many people visiting her grandpa. Fiona decided to stick close to her outgoing, older brother. She held his hand so that she would feel better. But Fiona still felt uneasy. Even though she loved her grandpa, she didn't like big crowds. She decided to quietly talk to her brother, who always took care of her. Fiona said, \"Please help me find a quiet place.\" Her brother kindly answered, \"There are lots of people, which can feel overwhelming. Let's go to grandpa's den.\" His den was a small, extra room that was packed with books. After Fiona went to the room, she quickly found a book and snuggled up on her favorite, cozy chair. Fiona immediately felt relieved because it was nice and quiet. When it was time to leave, Fiona sweetly said goodbye to her grandpa."},
            ],
            "EOY": [
                {"id": "2-BM1-EOY", "title": "Second Grade: Benchmark 1 (EOY)", "text": "On Saturday, Jacob, who loved the outdoors, was fishing with his grandpa at a nearby river delta. The triangle-shaped piece of land, which formed when the fresh water of the river flowed into the salty water of the ocean, was their favorite place to fish. Jacob tried to cast the line into the brackish water, but his line snagged in a tree behind him. Jacob panicked and thought he could just pull the line free. But when Jacob whipped the line hard, it got caught even worse! Jacob was frustrated. He hesitated to ask his grandpa, an expert fisherman, for help because he was obviously having a great time. Jacob nervously asked, \"Grandpa, can you help me?\" His grandpa said, \"Happy to help! That's quite the snag!\" After his grandpa expertly untangled the badly twisted line from the tree, Jacob moved so that his line wouldn't get caught again and excitedly cast out into the water. Jacob almost immediately caught a big, beautiful fish! He felt elated because he had never caught a fish that big before."},
                {"id": "2-BM2-EOY", "title": "Second Grade: Benchmark 2 (EOY)", "text": "Last week, Luiz went outside to feed his pet goats. His goats, which are called Fainting goats, are very friendly. However, when they get scared, their legs get stiff and they fall over. When Luiz poured some grain into their feeder, he noticed there was only one goat in the pen. The other goat had escaped and was eating some thick, overgrown bushes in the backyard. Luiz felt worried because he didn't know how he would catch the goat that always ran from him. He decided to slowly approach the cagey goat so that he could capture it. But every time he got close, it quickly bounded away. Luiz was frustrated. He decided to ask his dad, who knew about goats, for advice. Luiz said, \"Do you have any tips for catching my goat?\" His dad replied, \"Grab a handful of grain. Since goats can't resist food, it should follow you.\" After Luiz held out his hand with some grain, he was relieved because the goat eagerly followed him into the pen. Then Luiz made sure the gate was tightly shut."},
            ],
        },
    },
    "3": {
        "benchmark": {
            "BOY": [
                {"id": "3-BM1-BOY", "title": "Third Grade: Benchmark 1 (BOY)", "text": "Last week, Carla, who loved dressing up, was painting her nails at the new kitchen counter. She had some glittery, pink nail polish. When she inadvertently knocked over the small bottle, she was worried because she didn't want to stain the counter. It was quickly spilling everywhere, so she swiftly picked up the messy bottle. She decided to get a rag. Although Carla tried to clean it up, the rag didn't work. The bright, sparkly liquid smeared all over. She felt panicked. She needed her mom's help since she couldn't clean up the nail polish. So she decided to show her mom the counter. Carla said, \"I accidentally spilled nail polish. I need your help so that I can clean it.\" Carla's mom said, \"These new countertops are granite which is a porous rock that absorbs liquids. That's why you couldn't scrub the stain off the counter. You need something to help extract the nail polish. Nail polish remover will probably work.\" After her mom easily removed the stain, Carla was relieved because the mess was gone. Then Carla and her mom painted their nails together."},
                {"id": "3-BM2-BOY", "title": "Third Grade: Benchmark 2 (BOY)", "text": "Last spring, Molly drove with her family to a park that had beautiful, rolling hills. After they arrived, they unloaded their bikes so that they could go trail riding. Molly's bike, which was usually in pristine condition, started making a horrible, grinding sound. She looked down and saw that the chain had fallen off, likely because her bike had been neglected all winter. Even though Molly was worried, she decided to try riding without the chain. She pedaled hard, but her bike wouldn't move! Molly felt frustrated because her bike seemed useless. She wondered if her dad, who was an avid bike-rider, would be able to help. Molly walked her bike over to him and said, \"Could you help fix my bike?\" Molly's dad patiently replied, \"You simply need your chain tightened. Without a functioning bike chain, your bike can't get energy from the pedals to move the wheels.\" Fortunately, her dad always came prepared with bike tools. After he tightened the chain, Molly began riding again. She was happy because her bike worked perfectly! Molly easily traversed the park trails all day with her family."},
            ],
            "MOY": [
                {"id": "3-BM1-MOY", "title": "Third Grade: Benchmark 1 (MOY)", "text": "Yesterday morning, Jen quietly walked into the kitchen. She got up early so that she could make breakfast for her mom. When Jen saw her dad in the kitchen, she asked him to help her make breakfast. But sadly, her dad was in a hurry. Jen was disappointed because she needed some help. She wanted to make fresh, delicious popovers, which are her mom's favorite breakfast. Popovers are fluffy rolls that are baked in muffin tins. They are made with lots of eggs and butter. Jen decided to try to bake the popovers independently. She found the recipe. But she quickly grew frustrated because she couldn't understand the convoluted instructions. She decided to wake up her sister, who was a fabulous cook. Jen hesitantly woke her sister up. She whispered, \"Will you please help me make mom's special breakfast?\" Although Jen's sister was very fatigued, she immediately said, \"I forgot what day it is. I'll be right there to help you.\" After Jen and her sister cooked the breakfast, she was happy since she got to prepare her mom a special breakfast. Her mom loved it."},
                {"id": "3-BM2-MOY", "title": "Third Grade: Benchmark 2 (MOY)", "text": "Yesterday, Cody was at home getting ready for school. He was looking for his homework, which was an elaborate report on glaciers. He had spent hours writing about how glaciers are valleys of ice that slowly move across the land because they are thousands of feet thick. But he couldn't find it in his backpack. Cody desperately needed it so that he could get it to his teacher, who was very stern. When Cody couldn't find his report anywhere in the house, he was devastated since it had taken him so long to write it. He finally realized he had probably left it in the car, which was usually very messy. Cody looked in the car, but it had just been cleaned. He was hysterical because he really needed that report. He decided to talk to his mom. He urgently said, \"I can't find my report! Do you have it?\" Cody's mom uneasily said, \"I might have thrown it away.\" Then Cody searched through the grimy trash and recovered it. After he found his report, Cody was relieved and vowed to always put his homework away."},
            ],
            "EOY": [
                {"id": "3-BM1-EOY", "title": "Third Grade: Benchmark 1 (EOY)", "text": "Once, Jake, a brave boy, was eating lunch at his friend's house since they didn't have school that day. His friend challenged him to eat a red chili pepper. Red chili peppers are a hot type of pepper which start out green but turn red as they ripen. When Jake bit into it, the fiery, spicy pepper burned his mouth. It was painful. He was worried because it wouldn't stop burning. Jake decided to drink some water to cool off his mouth. He quickly guzzled a glass of water. Although it helped some, Jake couldn't stop the burning. He felt panicked. Jake desperately turned to his friend, who loves eating spicy food, thinking he could help. He frantically said, \"My mouth is still burning. What should I do?\" Jake's friend calmly said, \"You need to slowly drink some milk so that your mouth will stop burning.\" After Jake deliberately sipped some milk that his friend quickly gave him, which took him a long time, he felt relieved because the intolerable, intense pain was finally gone. Jake never ate another one of those scorching peppers again."},
                {"id": "3-BM2-EOY", "title": "Third Grade: Benchmark 2 (EOY)", "text": "Saturday, Megan was in her room, counting her allowance. She wanted to spend the money she had been saving on a fun, new camera. But Megan's mom wasn't home to drive her to the store. She was unhappy. Megan impatiently decided to find her older brother, who just got his license. Although she found him, he couldn't drive her because his vehicle, an old, worn-out truck, was out of commission. Megan was annoyed since she couldn't find a ride. Then Megan decided to call her mom to see if she could help. She said, \"Can you take me shopping so I can buy an instant camera? They are so cool! The film that you put in the camera has special chemicals, which develop pictures in seconds!\" Megan's mom said, \"I'll be home soon. Make sure your room is clean - then I will gladly take you.\" After Megan's mom got home and inspected her room, she willingly gave her a ride. Megan was ecstatic because she finally got to purchase the camera she'd been desperately waiting to buy. She quickly took a picture of her mom to thank her."},
            ],
        },
    },
}

# Add placeholder entries for grades 4-8 (single benchmark per period)
for grade in ["4", "5", "6", "7", "8"]:
    NLM_READING_STORIES[grade] = {"benchmark": {"BOY": [], "MOY": [], "EOY": []}}

DDM_GRIDS = {
    "IRREGULAR_WORDS": [
        ["the", "a", "to", "his", "I", "they", "you", "was"],
        ["said", "she", "do", "he", "some", "have", "little", "my"],
        ["like", "what", "were", "is", "love", "come", "are", "me"],
        ["how", "of", "this", "find", "where", "your", "over", "could"],
        ["from", "into", "who", "go", "here", "soon", "saw", "new"],
        ["good", "all", "no", "there", "away", "down", "does", "one"],
        ["out", "their", "off", "day", "would", "see"],
    ],
    "LETTER_SOUNDS": [
        ["M", "h", "S", "w", "e", "d", "v", "X"],
        ["H", "D", "F", "M", "J", "m", "th", "N"],
        ["W", "V", "G", "P", "I", "z", "L", "k"],
        ["f", "c", "y", "g", "j", "n", "B", "Y"],
        ["Q", "b", "O", "T", "r", "u", "E", "Z"],
        ["i", "p", "s", "C", "x", "a", "q", "R"],
        ["o", "l", "K", "t", "U", "A", "Sh", "ph"],
        ["ch", "wh", "Ch", "Th", "Qu", "Wh"],
    ],
    "LETTER_NAMES": [
        ["O", "t", "B", "Z", "I", "z", "j", "w"],
        ["l", "o", "r", "f", "A", "x", "g", "p"],
        ["e", "F", "R", "M", "q", "N", "H", "h"],
        ["n", "G", "u", "V", "D", "C", "U", "Q"],
        ["W", "i", "J", "O", "c", "P", "S", "a"],
        ["L", "v", "Y", "M", "y", "X", "b", "s"],
        ["E", "K", "d", "k", "T"],
    ],
}

DDM_DECODING_WORDS = {
    "CLOSED_SYLLABLES": ["min", "sal", "jom", "vun", "quim", "whav", "fap", "deg", "gib", "les", "pag", "rud", "tus", "baf", "shil", "het", "wan", "kex", "zick", "chom", "thuz", "vill", "cass", "noff"],
    "VCE": ["naze", "gude", "mepe", "sule", "wonkide", "atane", "jime", "tebe", "goke", "fene", "vome", "rame", "sove"],
    "BASIC_AFFIXES": ["hezes", "pafed", "senest", "bruful", "temness", "premiv", "foting", "unron", "repog", "miver", "dutless", "giply"],
    "ADVANCED_AFFIXES": ["mubtion", "discla", "gobic", "mavible", "gopture", "gepous", "bimog", "trizom", "nonplut", "zikable", "misdut", "transbub", "uniquin", "virupt"],
    "VOWEL_TEAMS": ["feep", "naig", "touv", "keat", "heag", "goupaik", "zay", "loak", "zoon", "soud", "wook", "poig", "shaw", "hieb", "roef", "zow", "bewk", "pauk"],
    "VOWEL_R_CONTROLLED": ["klar", "ner", "foarp", "mour", "lare", "lirparg", "tor", "wir", "ploor", "rark", "zair", "kear", "zur", "theer", "glier", "searc", "lourt", "vour", "slore"],
    "COMPLEX_VOWELS": ["vind", "nild", "zough", "keigh", "glaught", "kighdost", "vost", "grol", "figh", "pight", "wought", "pough"],
    "ADVANCED_WORD_FORMS": ["wecent", "smink", "lomb", "glistle", "ohong", "grombacent", "brism", "grunk", "mank", "ghosl", "futle"],
    "WORDS_IN_CONTEXT": "David made a new game. He called it Tembog. It used a lot of new words. David played the game with a stick that he called a stodrun. The game also used a big block with a hole in it that he called a goupaik. A player throws the stick through the hole in the block. If they miss, it is called a lirparg. If you get the stick through the hole, that is called a kighdost. They get one point. There are other people in the game called ungobers. They try to take the block away. If they take the block away, then they get a second block called a bimudgeic. If they take the block away again, then they get a golden block called a poughnigild. If they take the block away a third time, then they get a glowing block called a grombacent. Once anyone has a glowing block, they can exchange, or generate it for a very large block. Each player on the team wears lirmarves to protect them, which are made out of foam.",
}


@router.get("/stories/{grade}/{time_of_year}")
def get_stories(grade: str, time_of_year: str, assessment_type: str = "benchmark"):
    stories = NLM_READING_STORIES.get(grade, {}).get(assessment_type, {}).get(time_of_year, [])
    return {"grade": grade, "time_of_year": time_of_year, "stories": stories}


@router.get("/ddm-grid/{target}")
def get_ddm_grid(target: str):
    grid = DDM_GRIDS.get(target)
    if grid:
        return {"target": target, "type": "grid", "data": grid}
    words = DDM_DECODING_WORDS.get(target)
    if words:
        return {"target": target, "type": "word_list", "data": words}
    return {"target": target, "type": "not_found", "data": None}
